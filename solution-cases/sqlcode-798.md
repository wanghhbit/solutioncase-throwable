# 出现 DB2 SQL Error: SQLCODE = -798, SQLSTATE = 428C9 错误的原因及解决方法

### 1 错误描述

在通过「[DbVisualizer](http://blog.csdn.net/qq_35246620/article/details/54289875)」执行 SQL 语句插入数据的时候，报出如下错误：

![ERROR](http://img.blog.csdn.net/20171110210427936)

### 2 错误原因

通过观察上述标记出来的错误描述：

> DB2 SQL Error: SQLCODE = -798, SQLSTATE = 428C9, SQLERRMC = ID

然后，查询「[史上最全的 DB2 错误代码大全](http://blog.csdn.net/qq_35246620/article/details/56877433)」可知，此错误的原因为：

> -798 428C9 不能把一个值插入到用 GENERATED ALWAYS 定义的 ROWID 列

现在，我们在来看看我所使用的表的创建语句：

```
CREATE TABLE TBL_USER_CARD (
    ID BIGINT NOT NULL GENERATED ALWAYS AS IDENTITY,
    VERSION INTEGER,
    USER_NAME VARCHAR(126) NOT NULL,
    CARD_NAME VARCHAR(16) NOT NULL,
    PRIMARY KEY (ID)
);
```

观察上述 SQL 语句及报出信息，我们可以发现在建表语句中，字段 ID 的后面确实定义了`GENERATED ALWAYS AS IDENTITY`的列属性，而报出信息里面也提到了 ID，因此我们可以确定问题就出在 ID 字段上面啦！那么在插入数据的时候，为什么会报这个错误呢？

实际上，在 DB2 中对于自增字段，我们可以通过如下两种方式指定：

- **第 1 种**：`GENERATED BY DEFAULT AS IDENTITY`
- **第 2 种**`GENERATED ALWAYS AS IDENTITY`

两者的区别在于，第 1 种方式在插入数据时允许指定自增字段的值，只要不重复即可，并且数据库会自动设置下一个值；第 2 种方式则不允许指定，只能由数据库自动分配并插入。

通过观察建表语句，显然我们在建表的时候，是用第 2 种方式将字段 ID 设置为自增字段的，而我在插入语句的时候，却指定了 ID 字段的值。例如，

```
-- 错误的插入方法
INSERT INTO TBL_USER_CARD values(100, 0, 'charies', 'IQ_CARD'); 
```

如上面所示，此为错误的插入方式，错误的原因就在于我们设置了 ID 的值。

###  3 解决方法

既然我们已经知道了此错误发生的原因，那么修改就简单多了，方法有两种：

- **第 1 种**：修改建表语句，为

```
CREATE TABLE TBL_USER_CARD (
    ID BIGINT NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    VERSION INTEGER,
    USER_NAME VARCHAR(126) NOT NULL,
    CARD_NAME VARCHAR(16) NOT NULL,
    PRIMARY KEY (ID)
);
```

- **第 2 种**：插入数据时，将 ID 的值设置为`default`，例如

```
-- 正确的插入方法
INSERT INTO TBL_USER_CARD values(default, 0, 'charies', 'IQ_CARD'); 
```

如上所述，此两种方法都可以解决此错误，二者择一即可。


